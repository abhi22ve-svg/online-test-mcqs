<body>
  <div class="card" id="start-screen">
    <div style="text-align:center">
      <!-- 🖼️ Add your logo -->
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/55/Emblem_of_India.svg"
           alt="Logo" style="width:80px;margin-bottom:10px" />
      <h1>EPFO Labour Code Mock Test</h1>
    </div>

    <h3>Instructions</h3>
    <ul>
      <li>Total Questions: 3 (you can change this later)</li>
      <li>Each question carries 1 mark. No negative marking.</li>
      <li>You will have limited time to complete the test.</li>
      <li>Do not refresh or close the window once the test begins.</li>
      <li>Click <strong>Start Test</strong> when you are ready.</li>
    </ul>

    <div style="margin-top:20px">
      <label><strong>Enter your Name:</strong></label><br/>
      <input id="name" placeholder="Your full name" style="padding:6px;width:60%" /><br/><br/>
      <label>Duration (minutes):</label><br/>
      <input id="duration" type="number" min="1" value="10" style="padding:6px;width:60%" /><br/><br/>
      <button id="startBtn" disabled>Start Test</button>
    </div>
  </div>

  <!-- ===== QUIZ SCREEN ===== -->
  <div class="card" id="quiz" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div><span id="qnum"></span> / <span id="qcount"></span></div>
      <div class="timer">Time left: <span id="time">--:--</span></div>
    </div>
    <hr/>
    <div id="questionText"></div>
    <ul class="choices" id="choices"></ul>
    <div style="margin-top:14px">
      <button id="prev">Previous</button>
      <button id="next">Next</button>
      <button id="submit" style="float:right;background:#0b76ef;color:#fff">Submit</button>
    </div>
  </div>

  <!-- ===== RESULT SCREEN ===== -->
  <div class="card" id="result" style="display:none">
    <h2>Result</h2>
    <div id="score"></div>
    <button id="downloadCSV">Download result CSV</button>
    <p class="muted">Please send your result file to the examiner.</p>
  </div>

<script>
// ===== QUESTIONS =====
const QUESTIONS = [
  {"id":1,"q":"Which Article of the Indian Constitution guarantees equality before law?","choices":["Article 12","Article 14","Article 19","Article 21"],"answer":1},
  {"id":2,"q":"The Code on Wages, 2019 consolidates how many previous Acts?","choices":["3","4","5","6"],"answer":1},
  {"id":3,"q":"In which year was the EPFO established?","choices":["1947","1952","1962","1971"],"answer":1}
];

// ===== UTILITIES =====
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
const el=id=>document.getElementById(id)
let state={questions:[],answers:{},pos:0,endAt:0}
let timerInt=null

// Enable Start button only if name entered
el('name').addEventListener('input',()=>{
  el('startBtn').disabled = el('name').value.trim()===''
})

// ===== START TEST =====
el('startBtn').addEventListener('click', ()=>{
  const name=el('name').value.trim()
  const minutes=Math.max(1,parseInt(el('duration').value||10))
  const qcopy=QUESTIONS.map(q=>({...q,choices:[...q.choices]}))
  shuffle(qcopy)
  qcopy.forEach(q=>{q.choiceOrder=shuffle(q.choices.map((c,i)=>({text:c,orig:i})))})
  state.questions=qcopy
  state.answers={}
  state.pos=0
  state.endAt=Date.now()+minutes*60*1000
  el('start-screen').style.display='none'
  el('quiz').style.display=''
  el('qcount').innerText=qcopy.length
  renderQuestion()
  startTimer()
})

// ===== RENDER QUESTION =====
function renderQuestion(){
  const q=state.questions[state.pos]
  el('qnum').innerText=state.pos+1
  el('questionText').innerHTML=`<strong>${q.q}</strong>`
  const ul=el('choices')
  ul.innerHTML=''
  q.choiceOrder.forEach(c=>{
    const li=document.createElement('li')
    const checked=state.answers[q.id]===c.orig?'checked':''
    li.innerHTML=`<label><input type="radio" name="ch" ${checked}/> ${c.text}</label>`
    li.querySelector('input').addEventListener('change',()=>state.answers[q.id]=c.orig)
    ul.appendChild(li)
  })
}

el('next').addEventListener('click',()=>{
  if(state.pos<state.questions.length-1){state.pos++;renderQuestion()}
})
el('prev').addEventListener('click',()=>{
  if(state.pos>0){state.pos--;renderQuestion()}
})
el('submit').addEventListener('click',finalize)

// ===== FINALIZE =====
function finalize(){
  clearInterval(timerInt)
  const total=state.questions.length
  let correct=0
  const rows=[]
  state.questions.forEach(q=>{
    const chosen=state.answers[q.id]
    const isCorrect=(chosen!==undefined)&&(chosen===q.answer)
    if(isCorrect)correct++
    rows.push({id:q.id,question:q.q,selected:chosen===undefined?'':q.choices[chosen]||'',correct:q.choices[q.answer]})
  })
  el('quiz').style.display='none'
  el('result').style.display=''
  el('score').innerText=`Score: ${correct} / ${total}`
  window.__csv=rows
}

// ===== DOWNLOAD CSV =====
<div class="card" id="result" style="display:none">
  <h2>Result</h2>
  <div id="score"></div>
  <div id="percent"></div>
  <h3>Review:</h3>
  <div id="review"></div>
  <br/>
  <button id="downloadCSV">Download result CSV</button>
  <p class="muted">Please send your result file to the examiner.</p>
</div>


// ===== TIMER =====
function startTimer(){updateTimer();timerInt=setInterval(updateTimer,1000)}
function updateTimer(){
  const left=Math.max(0,Math.floor((state.endAt-Date.now())/1000))
  const mm=String(Math.floor(left/60)).padStart(2,'0')
  const ss=String(left%60).padStart(2,'0')
  el('time').innerText=`${mm}:${ss}`
  if(left<=0){clearInterval(timerInt);finalize()}
}
</script>
</body>

